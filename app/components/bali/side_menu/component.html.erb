<%# Mobile trigger checkbox - toggles sidebar visibility on mobile %>
<% if fixed? %>
  <input type="checkbox" id="<%= mobile_trigger_id %>"
         class="hidden side-menu-mobile-trigger"
         aria-label="<%= toggle_mobile_label %>" />
<% end %>

<%# Collapse checkbox - controls sidebar collapsed state via CSS %>
<% if collapsable? %>
  <input type="checkbox" id="<%= collapse_checkbox_id %>"
         class="hidden side-menu-collapse-trigger"
         aria-label="<%= toggle_collapse_label %>" />
<% end %>

<%= tag.div(**container_options) do %>
  <%# Header with collapse toggle %>
  <% if collapsable? %>
    <%# Expanded state header - toggle on the right %>
    <div class="side-menu-expanded flex min-h-10 items-center gap-3 px-2.5 pt-3">
      <% if brand? %>
        <span class="side-menu-brand text-xl font-semibold grow"><%= brand %></span>
      <% elsif collapsable? %>
        <span class="grow"></span>
      <% end %>
      <label for="<%= collapse_checkbox_id %>"
             title="<%= collapse_label %>"
             class="menu-item p-2 cursor-pointer shrink-0">
        <%= render Bali::Icon::Component.new('panel-left-close', class: 'size-4') %>
      </label>
    </div>
    <%# Collapsed state header - toggle centered like menu items %>
    <div class="side-menu-collapsed hidden px-1 py-3">
      <label for="<%= collapse_checkbox_id %>"
             title="<%= expand_label %>"
             class="collapse-toggle menu-item justify-center cursor-pointer">
        <%= render Bali::Icon::Component.new('panel-left-open',
              class: 'size-4') %>
      </label>
    </div>
  <% elsif brand? %>
    <div class="flex min-h-10 items-center gap-3 px-2.5 py-3">
      <% if brand? %>
        <span class="side-menu-brand text-xl font-semibold"><%= brand %></span>
      <% elsif collapsable? %>
        <span class="grow"></span>
      <% end %>
    </div>
  <% end %>

  <%# Menu switcher dropdown (when multiple menus) %>
  <% if multiple_menus? %>
    <div class="menu-switcher px-2.5 mb-3 mt-3">
      <div class="dropdown dropdown-bottom w-full">
        <div tabindex="0" role="button"
             class="border-base-300 hover:bg-base-200 rounded-box flex cursor-pointer items-center gap-2 border p-2">
          <%= active_menu %>
          <%= render Bali::Icon::Component.new('chevrons-up-down', class: 'ml-auto size-4 text-base-content/50') %>
        </div>
        <ul tabindex="0"
            class="dropdown-content menu bg-base-100 rounded-box z-50 mt-1 w-full p-2 shadow-lg">
          <% authorized_menus.each do |menu| %>
            <li>
              <a href="<%= menu.href %>" class="<%= 'active' if menu == active_menu %>">
                <%= menu %>
              </a>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%# Main menu content with scrolling %>
  <div class="sidebar-menu custom-scrollbar grow overflow-auto">
    <% lists.each do |list| %>
      <%= list %>
    <% end %>
  </div>
<% end %>

<%# Overlay for mobile (only when fixed) %>
<% if fixed? %>
  <label for="<%= mobile_trigger_id %>"
         class="side-menu-overlay"></label>
<% end %>
